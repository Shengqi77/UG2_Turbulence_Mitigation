The following instructions describe how to run the code, which is used to process all distorted sequences：

The distorted_sequences folder contains distorted sequences, while the method folder includes the code for each step of the method as well as intermediate results.

Run the following Matlab and python files in order. In each of the code files, you need to change the paths in the beginning of the file to point to your local drive. 

=====================================================================================================

1-Convert npy format to mat format: Run "distorted_sequences\npy2mat.py", and the results are in： "distorted_sequences/distorted_sequences_mat"

2-Compute optical flow and image registration: Run "method\step1_correct geometric distortion\files_average_opticalflow.m", and the results are in ："method\step1_correct geometric distortion\Intermediate results\final_mat_float_opticalflow"

3-Average the sharpest registered images: Run "method\step1_correct geometric distortion\files_frame_selection_average.m",  and the results are in ："method\step1_correct geometric distortion\Intermediate results\final_png_float_opticalflow_sharpest_average"

4-Remove remaining blur：Run "method\step2_deblur\test_realblur.py" and the results are in： "method\step2_deblur\results\deblurring\RealBlur_R\Uformer_B" 
   Note that the deblurring model we are using was trained on simulated data generated by the atmospheric turbulence simulator.

5-Postprocess and convert png format to npy format: Run "method\step3_postproess\postprocess.m" and "method\step4_png216bitnpy.py",  and the results are in： "method\final_result_npy"

Note the final results will be in: "method\final_result_npy" 

=====================================================================================================

Our code is designed to handle all sequences, so it may take some time to run. We apologize for any inconvenience this may cause.

